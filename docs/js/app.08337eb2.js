(function(e){function t(t){for(var o,d,r=t[0],s=t[1],c=t[2],u=0,l=[];u<r.length;u++)d=r[u],Object.prototype.hasOwnProperty.call(a,d)&&a[d]&&l.push(a[d][0]),a[d]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);w&&w(t);while(l.length)l.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,r=1;r<n.length;r++){var s=n[r];0!==a[s]&&(o=!1)}o&&(i.splice(t--,1),e=d(d.s=n[0]))}return e}var o={},a={app:0},i=[];function d(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,d),n.l=!0,n.exports}d.m=e,d.c=o,d.d=function(e,t,n){d.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},d.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.t=function(e,t){if(1&t&&(e=d(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(d.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)d.d(n,o,function(t){return e[t]}.bind(null,o));return n},d.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return d.d(t,"a",t),t},d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],s=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var w=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23"),a=n("ecdb"),i=n.n(a),d={class:"btn-group options"},r=Object(o["e"])("label",{class:"btn btn-outline-primary",for:"btncheck1"},"Model",-1),s=Object(o["e"])("label",{class:"btn btn-outline-primary",for:"btncheck2"},"Debug",-1),c=Object(o["e"])("a",{href:"https://github.com/ClarkThyLord/Vox-Face"},[Object(o["e"])("img",{src:i.a,alt:"Vox-Face",class:"vf-icon"})],-1),w=Object(o["e"])("video",{id:"cameraVideo"},null,-1),u=Object(o["e"])("canvas",{id:"threeCanvas"},null,-1);function l(e,t,n,a,i,l){var b=Object(o["j"])("About");return Object(o["i"])(),Object(o["d"])(o["a"],null,[Object(o["e"])("div",d,[Object(o["l"])(Object(o["e"])("input",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return l.showModel=e}),type:"checkbox",class:"btn-check",id:"btncheck1"},null,512),[[o["k"],l.showModel]]),r,Object(o["l"])(Object(o["e"])("input",{"onUpdate:modelValue":t[1]||(t[1]=function(e){return l.debugMode=e}),type:"checkbox",class:"btn-check",id:"btncheck2"},null,512),[[o["k"],l.debugMode]]),s,Object(o["e"])("button",{onClick:t[2]||(t[2]=function(){return l.showAbout&&l.showAbout.apply(l,arguments)}),type:"button",class:"btn btn-outline-secondary"}," About ")]),c,Object(o["g"])(b,{ref:"about"},null,512),Object(o["e"])("main",null,[w,u,Object(o["e"])("canvas",{class:Object(o["h"])({"d-none":!l.debugMode}),id:"humanCanvas"},null,2),Object(o["e"])("canvas",{class:Object(o["h"])({"d-none":!l.debugMode}),id:"segmentationCanvas"},null,2)])],64)}var b=n("1da1"),h=(n("96cf"),n("d3b7"),{class:"modal fade",tabindex:"-1",id:"About"}),p={class:"modal-dialog"},m={class:"modal-content"},g={class:"modal-body"},f=Object(o["f"])('<h2 class="text-center">Vox-Face</h2><p class="fst-normal text-center"><i>The Voxel Face AR Web App.</i></p><p class="fst-normal text-center text-muted"> Working on Chrome, Firefox. </p><p class="text-center"><a href="https://github.com/ClarkThyLord/Vox-Face" class="text-decoration-none"> GitHub </a></p>',4),v={key:0,class:"container debugOptions"},O={class:"row row-cols-2 justify-content-center mx-5"},x={class:"form-check form-switch"},y=Object(o["e"])("label",{class:"form-check-label",for:"drawBoxes"}," Draw Boxes ",-1),j={class:"form-check form-switch"},k=Object(o["e"])("label",{class:"form-check-label",for:"drawPoints"}," Draw Points ",-1),M={class:"form-check form-switch"},C=Object(o["e"])("label",{class:"form-check-label",for:"drawPolygons"}," Draw Polygons ",-1),D={class:"form-check form-switch"},F=Object(o["e"])("label",{class:"form-check-label",for:"drawGaze"}," Draw Gaze ",-1),P={class:"form-check form-switch"},V=Object(o["e"])("label",{class:"form-check-label",for:"drawSegmentation"}," Draw Segmentation ",-1),S=Object(o["e"])("div",{class:"modal-footer"},[Object(o["e"])("div",{class:"d-grid gap-2 col-6 mx-auto"},[Object(o["e"])("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ")])],-1);function _(e,t,n,a,i,d){return Object(o["i"])(),Object(o["d"])("div",h,[Object(o["e"])("div",p,[Object(o["e"])("div",m,[Object(o["e"])("div",g,[Object(o["e"])("img",{onDblclick:t[0]||(t[0]=function(e){return d.showDebugOptions=!d.showDebugOptions}),src:"vox-face.svg",alt:"",class:"rounded mx-auto d-block"},null,32),f,d.showDebugOptions?(Object(o["i"])(),Object(o["d"])("div",v,[Object(o["e"])("div",O,[Object(o["e"])("div",x,[Object(o["l"])(Object(o["e"])("input",{type:"checkbox",role:"switch","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.debugOptions.drawBoxes=e}),class:"form-check-input",id:"drawBoxes"},null,512),[[o["k"],i.debugOptions.drawBoxes]]),y]),Object(o["e"])("div",j,[Object(o["l"])(Object(o["e"])("input",{type:"checkbox",role:"switch","onUpdate:modelValue":t[2]||(t[2]=function(e){return i.debugOptions.drawPoints=e}),class:"form-check-input",id:"drawPoints"},null,512),[[o["k"],i.debugOptions.drawPoints]]),k]),Object(o["e"])("div",M,[Object(o["l"])(Object(o["e"])("input",{type:"checkbox",role:"switch","onUpdate:modelValue":t[3]||(t[3]=function(e){return i.debugOptions.drawPolygons=e}),class:"form-check-input",id:"drawPolygons"},null,512),[[o["k"],i.debugOptions.drawPolygons]]),C]),Object(o["e"])("div",D,[Object(o["l"])(Object(o["e"])("input",{type:"checkbox",role:"switch","onUpdate:modelValue":t[4]||(t[4]=function(e){return i.debugOptions.drawGaze=e}),class:"form-check-input",id:"drawGaze"},null,512),[[o["k"],i.debugOptions.drawGaze]]),F]),Object(o["e"])("div",P,[Object(o["l"])(Object(o["e"])("input",{type:"checkbox",role:"switch","onUpdate:modelValue":t[5]||(t[5]=function(e){return i.debugOptions.drawSegmentation=e}),class:"form-check-input",id:"drawSegmentation"},null,512),[[o["k"],i.debugOptions.drawSegmentation]]),V]),Object(o["e"])("button",{onClick:t[6]||(t[6]=function(){return d.reset&&d.reset.apply(d,arguments)}),type:"button",class:"m-auto btn btn-primary btn-sm"}," Reset ")])])):Object(o["c"])("",!0)]),S])])])}n("159b"),n("b64b");var B={name:"About",data:function(){return{_modal:void 0,_showDebugOptions:"true"===window.Cookies.get("showDebugOptions"),debugOptions:window.debugOptions}},computed:{showDebugOptions:{get:function(){return this.$data._showDebugOptions},set:function(e){Cookies.set("showDebugOptions",e),this.$data._showDebugOptions=e}}},mounted:function(){this._modal=new window.Bootstrap.Modal(document.getElementById("About"))},methods:{show:function(){this._modal&&this._modal.show()},hide:function(){this._modal&&this._modal.hide()},reset:function(){Object.keys(window.Cookies.get()).forEach((function(e){Cookies.remove(e)}))}}},A=n("6b0d"),z=n.n(A);const E=z()(B,[["render",_]]);var U=E,R=n("361b"),I=n("5a89"),T=n("b85c"),G=n("d4ec"),W=n("bee2"),$=n("262e"),H=n("2caf"),L=(n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),function(e){Object($["a"])(n,e);var t=Object(H["a"])(n);function n(e){var o;return Object(G["a"])(this,n),o=t.call(this),o.positions=new Float32Array(1434),o.setAttribute("position",new I["b"](o.positions,3)),o.setIndex(e),o}return Object(W["a"])(n,[{key:"update",value:function(e,t,n){var o,a=0,i=Object(T["a"])(n.mesh);try{for(i.s();!(o=i.n()).done;){var d=o.value;this.positions[a+0]=-d[0]+e/2,this.positions[a+1]=t-d[1]-t/2,this.positions[a+2]=-d[2],a+=3}}catch(r){i.e(r)}finally{i.f()}this.attributes.position.needsUpdate=!0,this.computeVertexNormals()}}]),n}(I["c"]));window.human=new R["a"]({backend:"webgl",modelBasePath:"models/",face:{enabled:!0,detector:{rotation:!0,maxDetected:1},mesh:{enabled:!0},iris:{enabled:!0},description:{enabled:!1},emotion:{enabled:!1}},hand:{enabled:!1},body:{enabled:!1},object:{enabled:!1},filter:{enabled:!1},gesture:{enabled:!1}});var N={name:"App",components:{About:U},data:function(){return{_showModel:"false"!==window.Cookies.get("showModel"),_debugMode:"true"===window.Cookies.get("debugMode")}},computed:{showModel:{get:function(){return this.$data._showModel},set:function(e){Cookies.set("showModel",e),this.$data._showModel=e}},debugMode:{get:function(){return this.$data._debugMode},set:function(e){Cookies.set("debugMode",e),this.$data._debugMode=e}}},methods:{showAbout:function(){this.$refs.about.show()},hideAbout:function(){this.$refs.about.hide()}},mounted:function(){var e=this;void 0===window.Cookies.get("seenAbout")&&(this.showAbout(),Cookies.set("seenAbout",!0,{expires:7})),window.threeCanvas=document.getElementById("threeCanvas"),window.humanCanvas=document.getElementById("humanCanvas"),window.segmentationCanvas=document.getElementById("segmentationCanvas"),window.segmentationContext=window.segmentationCanvas.getContext("2d"),window.threeRenderer=new I["i"]({antialias:!0,alpha:!0,canvas:window.threeCanvas}),window.threeRenderer.outputEncoding=I["j"],window.threeCamera=new I["g"],window.threeCamera.near=-1e3,window.threeCamera.far=1e3,window.threeScene=new I["h"],window.threeScene.fog=new I["d"](15716789,.0025);var t=new I["e"](new L(human.faceTriangulation),new I["f"]({color:16755370,wireframe:!0}));t.visible=!1,window.threeScene.add(t),window.voxFaceMesh=new I["e"](new I["a"](1,1,1),new I["f"]({color:"yellow"})),window.voxFaceMesh.visible=!1,window.threeScene.add(window.voxFaceMesh);var n=new I["e"](new I["a"](.25,.05,.25),new I["f"]({color:"brown"}));n.position.x=-.25,n.position.y=.425,n.position.z=.5,window.voxFaceMesh.add(n);var o=new I["e"](new I["a"](.25,.05,.25),new I["f"]({color:"brown"}));o.position.x=.25,o.position.y=.425,o.position.z=.5,window.voxFaceMesh.add(o);var a=new I["e"](new I["a"](.25,.25,.25),new I["f"]({color:"red"}));a.position.x=-.25,a.position.y=.25,a.position.z=.5,window.voxFaceMesh.add(a);var i=new I["e"](new I["a"](.25,.25,.25),new I["f"]({color:"red"}));i.position.x=.25,i.position.y=.25,i.position.z=.5,window.voxFaceMesh.add(i);var d=new I["e"](new I["a"](.35,.2,.25),new I["f"]({color:"green"}));d.position.x=0,d.position.y=-.15,d.position.z=.5,window.voxFaceMesh.add(d);var r=function(e){return e.srcObject&&"live"===e.srcObject.getVideoTracks()[0].readyState&&e.readyState>2&&!e.paused},s=function(){window.threeCamera.left=-window.innerWidth/2,window.threeCamera.right=window.innerWidth/2,window.threeCamera.top=window.innerHeight/2,window.threeCamera.bottom=-window.innerHeight/2,window.threeCamera.aspect=window.innerWidth/window.innerHeight,window.threeCamera.updateProjectionMatrix(),window.threeRenderer.setSize(window.innerWidth,window.innerHeight)};Object(b["a"])(regeneratorRuntime.mark((function c(){var w,u,l,h;return regeneratorRuntime.wrap((function(c){while(1)switch(c.prev=c.next){case 0:return window.addEventListener("unhandledrejection",(function(e){console.error(e.reason||e),e.preventDefault()})),c.next=3,human.load();case 3:if(navigator.mediaDevices){c.next=5;break}return c.abrupt("return",null);case 5:return window.cameraVideo=document.getElementById("cameraVideo"),window.threeCanvas.addEventListener("click",(function(){r(window.cameraVideo)?window.cameraVideo.pause():window.cameraVideo.play()})),w={audio:!1,video:{facingMode:"user",resizeMode:"crop-and-scale",width:{ideal:1920},aspectRatio:1920/1080}},c.next=10,navigator.mediaDevices.getUserMedia(w);case 10:if(u=c.sent,!u){c.next=15;break}window.cameraVideo.srcObject=u,c.next=16;break;case 15:return c.abrupt("return",null);case 16:return c.next=18,new Promise((function(e){window.cameraVideo.onloadeddata=Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window.cameraVideo.play(),e(window.cameraVideo);case 2:case"end":return t.stop()}}),t)})))}));case 18:l=c.sent,l&&(s(),window.addEventListener("resize",s),h=function(){var s=Object(b["a"])(regeneratorRuntime.mark((function s(c){var w,u,l,b,p,m,g,f,v,O,x,y,j,k,M,C,D,F,P,V,S,_,B,A,z,E,U,R,I,T,G,W,$,H,L,N,J,q,X,Y,Z,K,Q,ee,te,ne,oe,ae,ie,de,re,se,ce;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(w=!1,!r(c)){s.next=6;break}return s.next=4,human.detect(c);case 4:if(l=s.sent,(null===l||void 0===l||null===(u=l.face)||void 0===u?void 0:u.length)>0){if(human.next(l),O=l.face[0],t.geometry.update(c.videoWidth,c.videoHeight,O),t.geometry.computeBoundingBox(),t.geometry.boundingBox.getCenter(window.voxFaceMesh.position),window.voxFaceMesh.rotation.set((null===(b=O.rotation)||void 0===b||null===(p=b.angle)||void 0===p?void 0:p.pitch)||0,(null===(m=O.rotation)||void 0===m||null===(g=m.angle)||void 0===g?void 0:g.yaw)||0,(null===(f=O.rotation)||void 0===f||null===(v=f.angle)||void 0===v?void 0:v.roll)||0,"XYZ"),t.geometry.boundingBox.getSize(window.voxFaceMesh.scale),window.voxFaceMesh.scale.y*=1.25,window.voxFaceMesh.scale.x=window.voxFaceMesh.scale.y,window.voxFaceMesh.scale.z=window.voxFaceMesh.scale.y,O.box[2]>0&&O.box[3]>0){for(window.segmentationCanvas.width=O.box[2],window.segmentationCanvas.height=O.box[3],window.segmentationContext.drawImage(cameraVideo,O.box[0],O.box[1],O.box[2],O.box[3],0,0,window.segmentationCanvas.width,window.segmentationCanvas.height),x=window.segmentationContext.getImageData(0,0,window.segmentationCanvas.width,window.segmentationCanvas.height),y=window.segmentationContext.getImageData(0,0,window.segmentationCanvas.width,window.segmentationCanvas.height),j=0,k=0,M=0,void 0===window.debugOne&&(console.debug(O),window.debugOne=!1),C=0,D=0,F=0,P=O.annotations.leftEyebrowUpper[3][0]-O.box[0],V=O.annotations.leftEyebrowUpper[3][1]-O.box[1],S=0,_=0,B=0,A=O.annotations.rightEyebrowUpper[3][0]-O.box[0],z=O.annotations.rightEyebrowUpper[3][1]-O.box[1],E=0,U=0,R=0,I=O.mesh[386][0]-O.box[0],T=O.mesh[374][1]+(O.mesh[386][1]-O.mesh[374][1])-O.box[1],G=0,W=0,$=0,H=O.mesh[159][0]-O.box[0],L=O.mesh[145][1]+(O.mesh[159][1]-O.mesh[145][1])-O.box[1],N=0,J=0,q=0,X=O.annotations.noseTip[0][0]-O.box[0],Y=O.annotations.noseTip[0][1]-O.box[1]+50,Z=0;Z<x.data.length;Z+=4)K=Math.floor(Z/4%O.box[2]),Q=Math.floor(Z/4/O.box[2]),ee=x.data[Z]+30,te=x.data[Z+1]+30,ne=x.data[Z+2]+30,x.data[Z+3],oe=128,ae=.299*ee+.587*te+.114*ne,ie=.713*(ee-ae)+oe,de=.564*(ne-ae)+oe,re=ae>=0&&ae<=235&&ie>=133&&ie<=173&&de>=77&&de<=127,re&&(j+=ee,k+=te,M+=ne,y.data[Z]=255,y.data[Z+1]=0,y.data[Z+2]=0),se=!1,K==P&&Q==V&&(C=ee,D=te,F=ne),K>P-50&&K<P+30&&Q>V-5&&Q<V+25&&!re&&(y.data[Z]=165,y.data[Z+1]=42,y.data[Z+2]=42,se=!0),K==A&&Q==z&&(S=ee,_=te,B=ne),K>A-30&&K<A+50&&Q>z-5&&Q<z+25&&!re&&(y.data[Z]=165,y.data[Z+1]=42,y.data[Z+2]=42,se=!0),ce=(ee+te+ne)/3<145,K==I&&Q==T&&(E=ee,U=te,R=ne),K>I-30&&K<I+30&&Q>T-30&&Q<T+30&&!re&&!se&&ce&&(y.data[Z]=0,y.data[Z+1]=0,y.data[Z+2]=255),K==H&&Q==L&&(G=ee,W=te,$=ne),K>H-30&&K<H+30&&Q>L-30&&Q<L+30&&!re&&!se&&ce&&(y.data[Z]=0,y.data[Z+1]=0,y.data[Z+2]=255),K==X&&Q==Y&&(N=ee,J=te,q=ne),K>X-50&&K<X+50&&Q>Y-10&&Q<Y+10&&!re&&(y.data[Z]=0,y.data[Z+1]=255,y.data[Z+2]=0);j/=x.data.length/4,k/=x.data.length/4,M/=x.data.length/4,window.voxFaceMesh.material.color.set("rgb("+Math.round(j)+", "+Math.round(k)+", "+Math.round(M)+")"),n.material.color.set("rgb("+Math.round(C)+", "+Math.round(D)+", "+Math.round(F)+")"),o.material.color.set("rgb("+Math.round(S)+", "+Math.round(_)+", "+Math.round(B)+")"),a.material.color.set("rgb("+Math.round(E)+", "+Math.round(U)+", "+Math.round(R)+")"),i.material.color.set("rgb("+Math.round(G)+", "+Math.round(W)+", "+Math.round($)+")"),d.material.color.set("rgb("+Math.round(N)+", "+Math.round(J)+", "+Math.round(q)+")"),window.segmentationContext.putImageData(y,0,0)}e.debugMode&&(window.human.draw.options.drawBoxes=window.debugOptions.drawBoxes,window.human.draw.options.drawPoints=window.debugOptions.drawPoints,window.human.draw.options.drawPolygons=window.debugOptions.drawPolygons,window.human.draw.options.drawGaze=window.debugOptions.drawGaze,window.segmentationCanvas.style.display=window.debugOptions.drawSegmentation?"block":"none",window.humanCanvas.width=c.videoWidth,window.humanCanvas.height=c.videoHeight,human.draw.face(window.humanCanvas,l.face)),w=!0}case 6:window.voxFaceMesh.visible=w&&e.showModel,window.threeRenderer.render(window.threeScene,window.threeCamera),requestAnimationFrame((function(){return h(c)}));case 9:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}(),h(l));case 20:case"end":return c.stop()}}),c)})))()}};n("57c2");const J=z()(N,[["render",l]]);var q=J,X=(n("ab8b"),n("7b17")),Y=n("852e"),Z=n.n(Y);window.Bootstrap=X,window.Cookies=Z.a,window.saveDebugOptions=function(){Z.a.set("debugOptions",JSON.stringify(window.debugOptions))},window.resetDebugOptions=function(){window.debugOptions={drawBoxes:!0,drawPoints:!1,drawPolygons:!1,drawGaze:!1,drawSegmentation:!0}},window.loadDebugOptions=function(){window.debugOptions=window.Cookies.get("debugOptions"),void 0===window.debugOptions?window.resetDebugOptions():window.debugOptions=JSON.parse(window.debugOptions)},loadDebugOptions(),Object(o["b"])(q).mount("#app")},"57c2":function(e,t,n){"use strict";n("f372")},"75fc":function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="75fc"},ecdb:function(e,t,n){e.exports=n.p+"img/vox-face.ad9fcde5.svg"},f372:function(e,t,n){}});
//# sourceMappingURL=app.08337eb2.js.map